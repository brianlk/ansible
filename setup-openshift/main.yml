---
- name: Install OCP
  hosts: haproxy
  vars_files:
    - vars.yml
  gather_facts: true

  tasks:
    - name: Install haproxy
      ansible.builtin.include_tasks:
        file: install-haproxy.yml

    - name: Generate OCP config
      ansible.builtin.include_tasks:
        file: generate-ocp-config.yml

    - name: Print the url for node installation
      ansible.builtin.debug:
        msg: "
          coreos-installer install /dev/sda --insecure-ignition \
          --ignition-url=http://{{ haproxy_ip }}:8080/ocp/bootstrap.ign \
          --copy-network
          "
          
    - name: Check all fqdn for OCP
      ansible.builtin.include_tasks:
        file: check_fqdn.yml
      loop: "{{ apis }}"

    - name: Check ip address of nodes
      ansible.builtin.include_tasks:
        file: check_node_ip.yml
      loop:
        - "{{ masters | dict2items  }}"
        - "{{ workers | dict2items  }}"
        - "{{ bootstrap | dict2items }}"
