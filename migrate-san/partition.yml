---
- name: Check if there is existing partiton
  shell: |
    parted -j {{ item }} print 2>/dev/null
  register: part

- set_fact:
    pj: "{{ part.stdout | from_json }}"
  
- name: Fail the playbook when partition exists in new devices
  fail:
    msg: "{{ pj.disk }}"
  when: pj.disk.label != "" and pj.disk.partitions is defined
  any_errors_fatal: true

- name: Create partition on new device
  parted:
    device: "{{ item }}"
    number: 1
    flags: [ lvm ]
    state: present
  any_errors_fatal: true
