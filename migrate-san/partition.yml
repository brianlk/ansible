---
- name: Check if there is existing partiton
  shell: |
    lsblk {{ item }} | grep part
  register: part
  ignore_errors: true

- name: Fail the playbook when partition exists in new devices
  fail:
    msg: "Fail the playbook when partition exists in new devices"
  when: part.rc == 0
  any_errors_fatal: true

- name: Create partition on new device
  parted:
    device: "{{ item }}"
    number: 1
    flags: [ lvm ]
    state: present
  any_errors_fatal: true

- name: Create PVs
  command: pvcreate --zero y {{ item }}1