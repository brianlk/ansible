---
- hosts: promotedmaster
  tasks:
    # - name: Check the named in all hosts
    #   shell: "ps -ef | grep named | grep -v grep"

    - name: Copy /etc/named.conf
      copy:
        src: /etc/named.conf
        dest: "{{ item }}"
        remote_src: true
      loop:
        - "/etc/named.conf.slave.{{ ansible_date_time.iso8601_basic_short }}"
        - /etc/named.conf.promote-master

    - name: Copy /etc/named.conf
      shell: |
        alias cp=cp
        mkdir /var/tmp/standby
        cd /var/named/
        cp -pfr * /var/tmp/standby/

    - name: Update slave to master
      replace:
        path: /etc/named.conf.promote-master
        regexp: '(.*type.*)slave(.*)'
        replace: '\1master\2'

    - name: Update data directory
      lineinfile:
        path: /etc/named.conf.promote-master
        regexp: '(^\s+directory\s+)(\S+)'
        line: '\1 "/var/tmp/standby";'
        backrefs: yes


