---
- name: check server-id in mysql config
  block:
    - raw: |
        grep server-id "{{ my_cnf }}"
  rescue:
    - raw: |
        sed -i 's~\(\[mysqld\]\)~\1\nserver-id={{ sid }}~' "{{ my_cnf }}"

- name: check log-bin in mysql config
  block:
    - raw: |
        grep log_bin "{{ my_cnf }}"
  rescue:
    - raw: |
        sed -i 's~\(\[mysqld\]\)~\1\nlog_bin={{ datadir }}/mysql-bin.log~' "{{ my_cnf }}"
